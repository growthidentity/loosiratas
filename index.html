<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loosiratas</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Rajdhani', sans-serif;
    background: #050510;
    color: #c0d0e0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem 1rem 3rem;
    overflow-x: hidden;
  }

  /* Animated grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      linear-gradient(rgba(0,255,170,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,255,170,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    animation: gridScroll 20s linear infinite;
    pointer-events: none;
    z-index: 0;
  }
  @keyframes gridScroll {
    0% { transform: translateY(0); }
    100% { transform: translateY(60px); }
  }

  /* Ambient glow blobs */
  body::after {
    content: '';
    position: fixed;
    top: -200px;
    left: 50%;
    transform: translateX(-50%);
    width: 800px;
    height: 800px;
    background: radial-gradient(circle, rgba(0,255,170,0.06) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  .page { position: relative; z-index: 1; width: 100%; display: flex; flex-direction: column; align-items: center; }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 2rem;
  }
  .header h1 {
    font-family: 'Orbitron', monospace;
    font-size: 2.6rem;
    font-weight: 900;
    letter-spacing: 6px;
    text-transform: uppercase;
    background: linear-gradient(135deg, #00ffaa 0%, #00d4ff 50%, #a855f7 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 20px rgba(0,255,170,0.3));
  }
  .header .tagline {
    font-family: 'Orbitron', monospace;
    font-size: 0.7rem;
    letter-spacing: 8px;
    color: #00ffaa55;
    text-transform: uppercase;
    margin-top: 0.4rem;
  }

  /* Live bar */
  .live-bar {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    margin-bottom: 1.8rem;
    padding: 0.4rem 1.2rem;
    background: rgba(0,255,170,0.05);
    border: 1px solid rgba(0,255,170,0.15);
    border-radius: 30px;
  }
  .live-dot {
    width: 8px; height: 8px;
    background: #00ffaa;
    border-radius: 50%;
    box-shadow: 0 0 8px #00ffaa;
    animation: pulse 1.5s ease-in-out infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(0.8); }
  }
  .live-bar span {
    font-family: 'Orbitron', monospace;
    font-size: 0.65rem;
    letter-spacing: 3px;
    color: #00ffaa88;
    text-transform: uppercase;
  }

  .container {
    display: flex;
    gap: 2rem;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
    max-width: 1060px;
  }

  /* Glassmorphism panels */
  .panel {
    background: linear-gradient(135deg, rgba(10,15,30,0.85), rgba(15,20,40,0.75));
    backdrop-filter: blur(20px);
    border: 1px solid rgba(0,255,170,0.12);
    border-radius: 20px;
    padding: 1.8rem;
    flex: 1;
    min-width: 320px;
    position: relative;
    overflow: hidden;
  }
  .panel::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(0,255,170,0.4), rgba(0,212,255,0.4), transparent);
  }
  .panel::after {
    content: '';
    position: absolute;
    top: 0; right: 0;
    width: 1px; height: 100%;
    background: linear-gradient(180deg, rgba(0,255,170,0.2), transparent 50%, rgba(168,85,247,0.2));
  }

  /* Input panel */
  .panel-header {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    margin-bottom: 1rem;
  }
  .panel-header .icon {
    width: 32px; height: 32px;
    border-radius: 8px;
    background: linear-gradient(135deg, rgba(0,255,170,0.15), rgba(0,212,255,0.1));
    border: 1px solid rgba(0,255,170,0.25);
    display: flex; align-items: center; justify-content: center;
    font-size: 0.9rem;
  }
  .panel-header .title {
    font-family: 'Orbitron', monospace;
    font-size: 0.7rem;
    letter-spacing: 3px;
    color: #00ffaa99;
    text-transform: uppercase;
  }

  label {
    display: block;
    font-size: 0.85rem;
    color: #506880;
    margin-bottom: 0.5rem;
    letter-spacing: 0.5px;
  }

  textarea {
    width: 100%;
    height: 260px;
    background: rgba(5,8,20,0.8);
    border: 1px solid rgba(0,255,170,0.1);
    border-radius: 12px;
    color: #c0e8d8;
    font-family: 'Rajdhani', monospace;
    font-size: 1.05rem;
    font-weight: 500;
    padding: 1rem;
    resize: vertical;
    outline: none;
    transition: border-color 0.3s, box-shadow 0.3s;
    line-height: 1.6;
  }
  textarea::placeholder { color: #1e3040; }
  textarea:focus {
    border-color: rgba(0,255,170,0.35);
    box-shadow: 0 0 20px rgba(0,255,170,0.05), inset 0 0 20px rgba(0,255,170,0.02);
  }

  .stats-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.8rem;
    padding-top: 0.8rem;
    border-top: 1px solid rgba(0,255,170,0.06);
  }
  .stat {
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }
  .stat-label {
    font-family: 'Orbitron', monospace;
    font-size: 0.55rem;
    letter-spacing: 2px;
    color: #2a4050;
    text-transform: uppercase;
  }
  .stat-value {
    font-family: 'Orbitron', monospace;
    font-size: 0.85rem;
    color: #00ffaa;
    font-weight: 700;
  }

  /* Wheel panel */
  .wheel-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1.5rem;
  }

  .wheel-wrapper {
    position: relative;
    width: 300px;
    height: 300px;
  }

  /* Outer glow ring */
  .wheel-glow {
    position: absolute;
    inset: -12px;
    border-radius: 50%;
    background: conic-gradient(from 0deg, #00ffaa22, #00d4ff22, #a855f722, #00ffaa22);
    animation: glowSpin 6s linear infinite;
    filter: blur(6px);
  }
  @keyframes glowSpin {
    to { transform: rotate(360deg); }
  }
  .wheel-ring {
    position: absolute;
    inset: -4px;
    border-radius: 50%;
    border: 1px solid rgba(0,255,170,0.2);
  }

  canvas#wheel {
    position: relative;
    z-index: 1;
    width: 300px;
    height: 300px;
    border-radius: 50%;
  }

  .pointer {
    position: absolute;
    top: -14px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 3;
    width: 0; height: 0;
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-top: 26px solid #00ffaa;
    filter: drop-shadow(0 0 10px rgba(0,255,170,0.6)) drop-shadow(0 0 20px rgba(0,255,170,0.3));
  }

  /* Spin button */
  .spin-btn {
    font-family: 'Orbitron', monospace;
    font-size: 0.85rem;
    font-weight: 700;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: #050510;
    background: linear-gradient(135deg, #00ffaa, #00d4ff);
    border: none;
    border-radius: 50px;
    padding: 0.9rem 3rem;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .spin-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, transparent 30%, rgba(255,255,255,0.2) 50%, transparent 70%);
    transform: translateX(-100%);
    transition: transform 0.5s;
  }
  .spin-btn:hover:not(:disabled)::before { transform: translateX(100%); }
  .spin-btn:hover:not(:disabled) {
    transform: scale(1.05);
    box-shadow: 0 0 30px rgba(0,255,170,0.3), 0 0 60px rgba(0,255,170,0.1);
  }
  .spin-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }
  .spin-btn:active:not(:disabled) {
    transform: scale(0.97);
  }

  /* Winner */
  .winner-display {
    text-align: center;
    min-height: 80px;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  .winner-label {
    font-family: 'Orbitron', monospace;
    font-size: 0.6rem;
    letter-spacing: 5px;
    color: #00ffaa66;
    text-transform: uppercase;
  }
  .winner-name {
    font-family: 'Orbitron', monospace;
    font-size: 1.6rem;
    font-weight: 900;
    background: linear-gradient(135deg, #00ffaa, #00d4ff, #a855f7);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-top: 0.4rem;
    animation: winnerIn 0.5s ease-out;
    filter: drop-shadow(0 0 15px rgba(0,255,170,0.3));
  }
  @keyframes winnerIn {
    0% { transform: scale(0.3) translateY(20px); opacity: 0; }
    60% { transform: scale(1.08); }
    100% { transform: scale(1) translateY(0); opacity: 1; }
  }

  /* Scanline effect */
  .scanlines {
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.03) 2px,
      rgba(0,0,0,0.03) 4px
    );
    pointer-events: none;
    z-index: 99;
  }

  .confetti-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 100;
  }
</style>
</head>
<body>

<div class="scanlines"></div>

<div class="page">
  <div class="header">
    <h1>Loosiratas</h1>
    <div class="tagline">Juhuslik valik &bull; kiire &bull; aus</div>
  </div>

  <div class="live-bar">
    <div class="live-dot"></div>
    <span>Reaalajas</span>
  </div>

  <div class="container">
    <div class="panel">
      <div class="panel-header">
        <div class="icon">&#9998;</div>
        <div class="title">Osalejad</div>
      </div>
      <label for="names">Kleebi nimed siia (iga nimi eraldi real):</label>
      <textarea id="names" placeholder="Mari Maasikas&#10;Jaan Jansen&#10;Kati Karu&#10;Toomas Tamm&#10;..."></textarea>
      <div class="stats-row">
        <div class="stat">
          <span class="stat-label">Osalejaid</span>
          <span class="stat-value" id="nameCount">0</span>
        </div>
        <div class="stat">
          <span class="stat-label">Voidu %</span>
          <span class="stat-value" id="winChance">-</span>
        </div>
      </div>
    </div>

    <div class="panel wheel-area">
      <div class="panel-header" style="align-self:flex-start;">
        <div class="icon">&#9881;</div>
        <div class="title">Ratas</div>
      </div>
      <div class="wheel-wrapper">
        <div class="wheel-glow"></div>
        <div class="wheel-ring"></div>
        <div class="pointer"></div>
        <canvas id="wheel" width="600" height="600"></canvas>
      </div>
      <button class="spin-btn" id="spinBtn" onclick="spin()">Keera</button>
      <div class="winner-display" id="winnerDisplay"></div>
    </div>
  </div>
</div>

<canvas class="confetti-canvas" id="confetti"></canvas>

<script>
const COLORS = [
  '#00ffaa','#00d4ff','#a855f7','#06b6d4','#10b981',
  '#3b82f6','#8b5cf6','#14b8a6','#0ea5e9','#22d3ee',
  '#34d399','#60a5fa','#818cf8','#2dd4bf','#38bdf8',
  '#4ade80','#7c3aed','#0891b2','#059669','#6366f1'
];

const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const namesEl = document.getElementById('names');
const spinBtn = document.getElementById('spinBtn');
const nameCountEl = document.getElementById('nameCount');
const winChanceEl = document.getElementById('winChance');
const winnerDisplay = document.getElementById('winnerDisplay');

let currentAngle = 0;
let spinning = false;
let names = [];

function getNames() {
  return namesEl.value.split('\n').map(n => n.trim()).filter(n => n.length > 0);
}

namesEl.addEventListener('input', () => {
  names = getNames();
  nameCountEl.textContent = names.length;
  winChanceEl.textContent = names.length > 0 ? (100 / names.length).toFixed(1) + '%' : '-';
  drawWheel();
});

function drawWheel(highlightIndex = -1) {
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const r = cx - 10;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Dark base
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI * 2);
  ctx.fillStyle = '#080818';
  ctx.fill();

  if (names.length === 0) {
    ctx.fillStyle = '#15253a';
    ctx.font = '600 22px Rajdhani, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('Lisa nimesid...', cx, cy);

    // Decorative ring
    ctx.beginPath();
    ctx.arc(cx, cy, r - 2, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(0,255,170,0.1)';
    ctx.lineWidth = 2;
    ctx.stroke();
    return;
  }

  const sliceAngle = (Math.PI * 2) / names.length;

  names.forEach((name, i) => {
    const start = currentAngle + i * sliceAngle;
    const end = start + sliceAngle;
    const baseColor = COLORS[i % COLORS.length];

    // Slice fill
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, start, end);
    ctx.closePath();

    // Gradient per slice
    const midAngle = start + sliceAngle / 2;
    const gx = cx + Math.cos(midAngle) * r * 0.5;
    const gy = cy + Math.sin(midAngle) * r * 0.5;
    const grad = ctx.createRadialGradient(cx, cy, 20, gx, gy, r);
    grad.addColorStop(0, baseColor + '40');
    grad.addColorStop(1, baseColor + 'cc');
    ctx.fillStyle = grad;

    if (highlightIndex >= 0 && highlightIndex !== i) {
      ctx.globalAlpha = 0.2;
    }
    ctx.fill();
    ctx.globalAlpha = 1;

    // Slice border
    ctx.strokeStyle = 'rgba(0,0,0,0.4)';
    ctx.lineWidth = 1.5;
    ctx.stroke();

    // Inner glow line
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    const lx = cx + Math.cos(start) * r;
    const ly = cy + Math.sin(start) * r;
    ctx.lineTo(lx, ly);
    ctx.strokeStyle = 'rgba(0,255,170,0.08)';
    ctx.lineWidth = 1;
    ctx.stroke();

    // Text
    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(midAngle);
    const textR = r * 0.62;
    const label = name.length > 14 ? name.slice(0, 12) + '..' : name;
    const fontSize = Math.min(20, 220 / names.length + 10);
    ctx.font = `700 ${fontSize}px Rajdhani, sans-serif`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    // Shadow
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillText(label, textR + 1, 1);
    // Main text
    ctx.fillStyle = '#fff';
    ctx.fillText(label, textR, 0);
    ctx.restore();
  });

  // Highlight glow on winner
  if (highlightIndex >= 0) {
    const start = currentAngle + highlightIndex * sliceAngle;
    const end = start + sliceAngle;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, start, end);
    ctx.closePath();
    ctx.strokeStyle = '#00ffaa';
    ctx.lineWidth = 3;
    ctx.shadowColor = '#00ffaa';
    ctx.shadowBlur = 20;
    ctx.stroke();
    ctx.shadowBlur = 0;
  }

  // Outer ring
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI * 2);
  ctx.strokeStyle = 'rgba(0,255,170,0.2)';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Center hub
  const hubGrad = ctx.createRadialGradient(cx, cy, 5, cx, cy, 32);
  hubGrad.addColorStop(0, '#0a1520');
  hubGrad.addColorStop(1, '#050510');
  ctx.beginPath();
  ctx.arc(cx, cy, 30, 0, Math.PI * 2);
  ctx.fillStyle = hubGrad;
  ctx.fill();
  ctx.strokeStyle = '#00ffaa44';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Hub inner dot
  ctx.beginPath();
  ctx.arc(cx, cy, 5, 0, Math.PI * 2);
  ctx.fillStyle = '#00ffaa';
  ctx.shadowColor = '#00ffaa';
  ctx.shadowBlur = 10;
  ctx.fill();
  ctx.shadowBlur = 0;
}

function spin() {
  names = getNames();
  if (names.length < 2) {
    alert('Lisa vahemalt 2 nime!');
    return;
  }
  if (spinning) return;
  spinning = true;
  spinBtn.disabled = true;
  winnerDisplay.innerHTML = '';

  const sliceAngle = (Math.PI * 2) / names.length;
  const winnerIndex = Math.floor(Math.random() * names.length);
  const targetSliceCenter = winnerIndex * sliceAngle + sliceAngle / 2;
  const pointerAngle = -Math.PI / 2;
  const extraSpins = (5 + Math.random() * 4) * Math.PI * 2;
  const targetAngle = extraSpins + (pointerAngle - targetSliceCenter - currentAngle);

  const startAngle = currentAngle;
  const duration = 4500 + Math.random() * 1500;
  const startTime = performance.now();

  function easeOut(t) {
    return 1 - Math.pow(1 - t, 4);
  }

  function animate(now) {
    const elapsed = now - startTime;
    const t = Math.min(elapsed / duration, 1);
    const eased = easeOut(t);

    currentAngle = startAngle + targetAngle * eased;

    // Pulsing glow while spinning
    const glow = document.querySelector('.wheel-glow');
    if (t < 1) {
      glow.style.filter = `blur(${4 + Math.sin(elapsed * 0.01) * 4}px)`;
      glow.style.opacity = 0.6 + Math.sin(elapsed * 0.008) * 0.4;
    } else {
      glow.style.filter = 'blur(6px)';
      glow.style.opacity = 1;
    }

    drawWheel();

    if (t < 1) {
      requestAnimationFrame(animate);
    } else {
      spinning = false;
      spinBtn.disabled = false;
      currentAngle = currentAngle % (Math.PI * 2);
      drawWheel(winnerIndex);
      showWinner(names[winnerIndex]);
      launchConfetti();
    }
  }
  requestAnimationFrame(animate);
}

function showWinner(name) {
  winnerDisplay.innerHTML = `
    <div class="winner-label">Palju &otilde;nne!</div>
    <div class="winner-name">${escapeHtml(name)}</div>
  `;
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// Confetti with neon particles
function launchConfetti() {
  const c = document.getElementById('confetti');
  const cCtx = c.getContext('2d');
  c.width = window.innerWidth;
  c.height = window.innerHeight;

  const neonColors = ['#00ffaa','#00d4ff','#a855f7','#22d3ee','#34d399','#60a5fa','#8b5cf6'];
  const pieces = [];
  for (let i = 0; i < 180; i++) {
    pieces.push({
      x: c.width / 2 + (Math.random() - 0.5) * 200,
      y: c.height / 2 - 100,
      w: 3 + Math.random() * 5,
      h: 8 + Math.random() * 10,
      color: neonColors[Math.floor(Math.random() * neonColors.length)],
      vx: (Math.random() - 0.5) * 12,
      vy: -8 - Math.random() * 10,
      rot: Math.random() * Math.PI * 2,
      rv: (Math.random() - 0.5) * 0.3,
      opacity: 1,
      glow: Math.random() > 0.5
    });
  }

  let frame = 0;
  function animateConfetti() {
    cCtx.clearRect(0, 0, c.width, c.height);
    frame++;
    let alive = false;
    pieces.forEach(p => {
      p.vx *= 0.99;
      p.vy += 0.15;
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.rv;
      if (frame > 60) p.opacity -= 0.012;
      if (p.opacity <= 0) return;
      alive = true;
      cCtx.save();
      cCtx.translate(p.x, p.y);
      cCtx.rotate(p.rot);
      cCtx.globalAlpha = Math.max(0, p.opacity);
      if (p.glow) {
        cCtx.shadowColor = p.color;
        cCtx.shadowBlur = 8;
      }
      cCtx.fillStyle = p.color;
      cCtx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
      cCtx.restore();
    });
    if (alive) requestAnimationFrame(animateConfetti);
    else cCtx.clearRect(0, 0, c.width, c.height);
  }
  requestAnimationFrame(animateConfetti);
}

drawWheel();
</script>
</body>
</html>
